<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Productos - Agrosell Nova</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" />
    <style>
        /* Modal fondo */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        /* Contenido */
        .modal-content {
            color: #333333;
            margin: 10px;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            width: 350px;
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-in-out;
        }

        .modal-content h2 {
            margin-bottom: 10px;
        }

        .modal-content input {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
        }

        .btn-confirmar {
            background: #28a745;
            color: #fff;
            padding: 10px;
            width: 100%;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn-confirmar:hover {
            background: #218838;
        }

        /* Bot√≥n cerrar */
        .close {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 22px;
            cursor: pointer;
        }

        /* Animaci√≥n */
        @keyframes fadeIn {
            from {opacity: 0; transform: scale(0.9);}
            to {opacity: 1; transform: scale(1);}
        }

        /* Contenedor de los toasts */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Estilo base */
        .toast {
            min-width: 250px;
            padding: 12px 16px;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            animation: fadeInUp 0.4s, fadeOut 0.5s 3s forwards;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* Colores seg√∫n tipo */
        .toast-success { background: #28a745; }
        .toast-error { background: #dc3545; }
        .toast-warning { background: #ffc107; color: #000; }

        /* Animaciones */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(20px); }
        }

    </style>
</head>

<body>
<header class="top-bar">
    <div class="header-content">
        <img src="/img/logo.png" alt="Agrosell Nova" class="logo">
        <h1 class="menu-title">AGROSELL NOVA</h1>

        <div class="panel-option">
            <button id="panelControl">
                <a th:href="@{/private/panel_control}" class="menu-icon"><i class="fa fa-cog"></i></a>
            </button>
        </div>

        <a th:href="@{/public/carrito}" class="menu-icon">
            <i class="fas fa-shopping-cart"></i>
        </a>

        <span class="menu-notification">
            <button id="notificationButton">
                <i class="fas fa-bell menu-icon"></i>
            </button>
        </span>

        <span class="username">
            <th:block th:if="${usuario != null}">
                <a th:text="${usuario}" th:href="@{/public/cerrar_sesion}"></a>
            </th:block>
            <th:block th:unless="${usuario != null}">
                <a th:href="@{/public/index}">Iniciar sesi√≥n</a>
            </th:block>
        </span>

        <a th:href="@{/private/perfil}" class="menu-icon">
            <i class="bi bi-person-circle" style="font-size: 30px;"></i>
        </a>
    </div>
</header>

<nav class="menu-bar" id="menu-bar">
    <button class="menu-toggle" id="menu-toggle">&#9776;</button>
    <ul id="menu-items">
        <li><a th:href="@{/public/inicio}"><i class="fas fa-home"></i> Inicio</a></li>
        <li><a th:href="@{/public/productos}"><i class="fas fa-box"></i> Productos</a></li>
        <li><a th:href="@{/public/reservas}"><i class="fas fa-bookmark"></i> Reservas</a></li>
        <li><a th:href="@{/public/about_us}"><i class="fas fa-info-circle"></i> Sobre nosotros</a></li>
        <li><a th:href="@{/public/contactanos}"><i class="fas fa-envelope"></i> Cont√°ctanos</a></li>
        <li><a th:href="@{/public/ayuda}"><i class="fas fa-question-circle"></i> Ayuda</a></li>
    </ul>
</nav>


<main>
    <section class="producto-titulo">
        <h1>¬°Todos los productos que buscas est√°n aqu√≠!</h1>
    </section>

    <section class="filtra-productos">
        <form action="/public/productos" method="get">
            <label for="nombre_producto">Producto:</label>
            <input type="text" name="producto" id="nombre_producto"
                   th:value="${param.producto}" placeholder="Ej: Manzanas" />

            <label for="orden">Ordenar por:</label>
            <select name="orden" id="orden">
                <option value="recientes" th:selected="${param.orden == 'recientes'}">M√°s recientes</option>
                <option value="precio_menor" th:selected="${param.orden == 'precio_menor'}">Precio menor</option>
                <option value="precio_mayor" th:selected="${param.orden == 'precio_mayor'}">Precio mayor</option>
                <option value="nombre" th:selected="${param.orden == 'nombre'}">A-Z</option>
            </select>

            <button type="submit">BUSCAR PRODUCTO</button>
        </form>
    </section>

    <section id="productos" class="productos-section">
        <div th:each="producto : ${productos}" class="productos-imagenes">
            <img th:src="${producto.imagen}" alt="Producto">
            <div class="productos-texto">
                <h3 th:text="${producto.nombre}">Nombre producto</h3>
                <p th:text="'$' + ${#numbers.formatDecimal(producto.precio, 1, 'COMMA', '2', 'POINT')} + ' / Kg'">Precio</p>
                <p th:text="${producto.descripcion}">Descripcion del producto</p>
                <a href="#" class="btn-a√±adir-carrito"
                   th:attr="onclick=|agregarAlCarrito(${producto.id}, '${producto.nombre}', ${producto.precio},
                   '${producto.imagen}', ${producto.stock})|">
                    A√±adir al carrito
                </a>
            </div>
        </div>
        <div th:if="${#lists.isEmpty(productos)}">
            <p>No se encontraron productos disponibles para mostrar.</p>
        </div>
    </section>

    <!-- Contenedor de toasts -->
    <div id="toast-container"></div>

    <!-- Modal para a√±adir al carrito -->
    <div id="carritoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal()">&times;</span>
            <h2 id="modal-nombre"></h2>
            <img id="modal-imagen" src="" alt="Producto" style="width: 150px; margin: 10px auto; display: block;">
            <p id="modal-precio"></p>
            <p id="modal-stock"></p>
            <label for="modal-cantidad">Cantidad (Kg):</label>
            <input type="number" id="modal-cantidad" min="1" value="1" class="form-control">
            <button class="btn-confirmar" onclick="confirmarAgregar()">A√±adir al carrito</button>
        </div>
    </div>


</main>

<footer class="footer">
    <div class="footer-container">
        <div class="footer-column">
            <h3>Enlaces r√°pidos</h3>
            <ul>
                <li><a th:href="@{/public/inicio}">Inicio</a></li>
<!--                <li><a th:href="@{/public/categorias}">Categor√≠as</a></li>-->
                <li><a th:href="@{/public/contactanos}">Cont√°ctanos</a></li>
                <li><a th:href="@{/public/about_us}">Sobre nosotros</a></li>
                <li><a th:href="@{/public/mapa}">Mapa del sitio</a></li>
                <li><a th:href="@{/public/404}">Error 404</a></li>
                <li><a th:href="@{/public/500}">Error 500</a></li>
                <li><a th:href="@{/public/dashboard}">Dashboard</a></li>
            </ul>
        </div>

        <div class="footer-column">
            <h3>Contacto</h3>
            <p>üìç Direcci√≥n: Calle Principal #123</p>
            <p>üìû Tel√©fono: +57 123 456 789</p>
            <p>üìß Email: <a href="mailto:info@agrosellnova.com">info@agrosellnova.com</a></p>
        </div>

        <div class="footer-column">
            <h3>S√≠guenos</h3>
            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2024 Agrosell Nova. Todos los derechos reservados. <a th:href="@{/public/terminos}">T√©rminos y condiciones</a></p>
    </div>
</footer>

<script>
    document.getElementById('notificationButton').addEventListener('click', function () {
        alert("No tienes notificaciones pendientes");
    });

    let productoSeleccionado = {};

    function agregarAlCarrito(id, nombre, precio, imagen, stock) {
        productoSeleccionado = { id, nombre, precio, imagen, stock };

        document.getElementById("modal-nombre").textContent = nombre;
        document.getElementById("modal-precio").textContent = `Precio: $${precio} / Kg`;
        document.getElementById("modal-stock").textContent = `Stock disponible: ${stock}`;
        document.getElementById("modal-imagen").src = imagen;
        document.getElementById("modal-cantidad").value = 1;

        document.getElementById("carritoModal").style.display = "flex";
    }

    function cerrarModal() {
        document.getElementById("carritoModal").style.display = "none";
    }

    function confirmarAgregar() {
        let cantidad = parseInt(document.getElementById("modal-cantidad").value);

        if (isNaN(cantidad) || cantidad <= 0) {
            showToast("‚ö†Ô∏è Cantidad inv√°lida.", "error");
            return;
        }

        if (cantidad > productoSeleccionado.stock) {
            showToast(`‚ùå Stock insuficiente. Disponible:`, "warning");
            return;
        }

        const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
        const producto = { ...productoSeleccionado, cantidad };
        carrito.push(producto);
        localStorage.setItem("carrito", JSON.stringify(carrito));

        showToast(`${productoSeleccionado.nombre} (${cantidad} Kg) a√±adido al carrito. ‚úÖ`, "success");
        cerrarModal();
    }


    function showToast(message, type = "success") {
        const container = document.getElementById("toast-container");

        const toast = document.createElement("div");
        toast.classList.add("toast", `toast-${type}`);
        toast.textContent = message;

        container.appendChild(toast);

        // Eliminar despu√©s de 4s
        setTimeout(() => {
            toast.remove();
        }, 4000);
    }



    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            const later = () => {
                clearTimeout(timeout);
                func.apply(this, args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    window.addEventListener("scroll", debounce(function () {
        const menuBar = document.querySelector(".menu-bar");
        if (window.scrollY > 50) {
            menuBar.classList.add("scrolled");
        } else {
            menuBar.classList.remove("scrolled");
        }
    }, 100));

    const toggleButton = document.getElementById('menu-toggle');
    const menuBar = document.getElementById('menu-bar');

    toggleButton.addEventListener('click', () => {
        menuBar.classList.toggle('active');
    });
</script>

</body>
</html>
